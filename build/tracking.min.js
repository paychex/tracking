/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

/**
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Dan Barnes
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */

!function(t,e){"function"==typeof define&&define.amd?define([],e):t.Tracking=e()}(this,function(){var t,e,n;return function(r){function i(t,e){return b.call(t,e)}function o(t,e){var n,r,i,o,s,a,c,u,f,l,d,p,h=e&&e.split("/"),m=x.map,w=m&&m["*"]||{};if(t){for(t=t.split("/"),s=t.length-1,x.nodeIdCompat&&E.test(t[s])&&(t[s]=t[s].replace(E,"")),"."===t[0].charAt(0)&&h&&(p=h.slice(0,h.length-1),t=p.concat(t)),f=0;f<t.length;f++)if("."===(d=t[f]))t.splice(f,1),f-=1;else if(".."===d){if(0===f||1===f&&".."===t[2]||".."===t[f-1])continue;f>0&&(t.splice(f-1,2),f-=2)}t=t.join("/")}if((h||w)&&m){for(n=t.split("/"),f=n.length;f>0;f-=1){if(r=n.slice(0,f).join("/"),h)for(l=h.length;l>0;l-=1)if((i=m[h.slice(0,l).join("/")])&&(i=i[r])){o=i,a=f;break}if(o)break;!c&&w&&w[r]&&(c=w[r],u=f)}!o&&c&&(o=c,a=u),o&&(n.splice(0,a,o),t=n.join("/"))}return t}function s(t,e){return function(){var n=S.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),h.apply(r,n.concat([t,e]))}}function a(t){return function(e){return o(e,t)}}function c(t){return function(e){g[t]=e}}function u(t){if(i(v,t)){var e=v[t];delete v[t],y[t]=!0,p.apply(r,e)}if(!i(g,t)&&!i(y,t))throw new Error("No "+t);return g[t]}function f(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function l(t){return t?f(t):[]}function d(t){return function(){return x&&x.config&&x.config[t]||{}}}var p,h,m,w,g={},v={},x={},y={},b=Object.prototype.hasOwnProperty,S=[].slice,E=/\.js$/;m=function(t,e){var n,r=f(t),i=r[0],s=e[1];return t=r[1],i&&(i=o(i,s),n=u(i)),i?t=n&&n.normalize?n.normalize(t,a(s)):o(t,s):(t=o(t,s),r=f(t),i=r[0],t=r[1],i&&(n=u(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:n}},w={require:function(t){return s(t)},exports:function(t){var e=g[t];return void 0!==e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:d(t)}}},p=function(t,e,n,o){var a,f,d,p,h,x,b,S=[],E=typeof n;if(o=o||t,x=l(o),"undefined"===E||"function"===E){for(e=!e.length&&n.length?["require","exports","module"]:e,h=0;h<e.length;h+=1)if(p=m(e[h],x),"require"===(f=p.f))S[h]=w.require(t);else if("exports"===f)S[h]=w.exports(t),b=!0;else if("module"===f)a=S[h]=w.module(t);else if(i(g,f)||i(v,f)||i(y,f))S[h]=u(f);else{if(!p.p)throw new Error(t+" missing "+f);p.p.load(p.n,s(o,!0),c(f),{}),S[h]=g[f]}d=n?n.apply(g[t],S):void 0,t&&(a&&a.exports!==r&&a.exports!==g[t]?g[t]=a.exports:d===r&&b||(g[t]=d))}else t&&(g[t]=n)},t=e=h=function(t,e,n,i,o){if("string"==typeof t)return w[t]?w[t](e):u(m(t,l(e)).f);if(!t.splice){if(x=t,x.deps&&h(x.deps,x.callback),!e)return;e.splice?(t=e,e=n,n=null):t=r}return e=e||function(){},"function"==typeof n&&(n=i,i=o),i?p(r,t,e,n):setTimeout(function(){p(r,t,e,n)},4),h},h.config=function(t){return h(t)},t._defined=g,n=function(t,e,n){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(n=e,e=[]),i(g,t)||i(v,t)||(v[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("../node_modules/almond/almond",function(){}),n("Stopwatch",[],function(){"use strict";function t(){}function e(){return Date.now?Date.now():(new Date).getTime()}var n=window.performance||{};return t.navigationStart=function(){return"timeOrigin"in n?n.timeOrigin:n.timing?n.timing.navigationStart:e()}(),t.elapsed=function(){return n.now?n.now():Math.abs(e()-t.navigationStart)},t.now=function(){return t.navigationStart+t.elapsed()},t}),n("uuid",[],function(){"use strict";function t(t){var e,n;if(window.crypto&&window.crypto.getRandomValues)e=new Uint8Array(t),window.crypto.getRandomValues(e);else for(e=new Array(t),n=(new Date).getTime();t--;)e[t]=n+16*Math.random()&15;return e}return function(){var e=t(36);return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t,n){var r=15&e[n];return("x"===t?r:3&r|8).toString(16)})}}),n("TrackingInfo",["./Stopwatch","./uuid"],function(t,e){"use strict";function n(){for(var t=[].slice.call(arguments),e=t.shift();t.length&&void 0===e;)e=t.shift();return e}function r(t){var e=[].slice.call(arguments),r=e.pop();return e.slice(1).reduce(function(e,r){return n((t.data||{})[r],t[r],e)},r)}function i(t){return Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},{})}return function n(o){if(!(this instanceof n))return new n(o);this.data=i(o.data||{}),this.tags=r(o,"tags",[]),this.count=r(o,"count",1),this.type=r(o,"type","unknown"),this.id=r(o,"id",void 0)||e(),this.start=r(o,"start","startTime",t.now()),this.stop=r(o,"stop","stopTime","end","endTime",this.start),this.duration=this.stop-this.start,this.label=r(o,"label","description",void 0),this.action=r(o,"action",void 0),this.category=r(o,"category",void 0),this.variable=r(o,"variable",void 0),this.children=r(o,"children",[]).map(n),Object.keys(this).forEach(function(t){delete this.data[t]}.bind(this)),this.toString=function(){return"TrackingInfo: "+JSON.stringify(this,null,2)},Object.freeze(this)}}),n("mixins/Errors",["../TrackingInfo"],function(t){"use strict";return function e(n){return e.log=function(e){if(!(e instanceof Error))throw new Error("An Error instance must be specified.");var r=new t({type:"error",data:e});r.data.name=e.name,r.data.stack=e.stack,r.data.message=e.message,n(r)},e}}),n("mixins/Events",["../TrackingInfo"],function(t){"use strict";return function e(n){return e.fire=function(e,r){if("string"!=typeof e||!e.length)throw new Error("An event action must be specified.");n(new t({action:e,data:r,type:"event"}))},e}}),n("mixins/Timers",["../Stopwatch","../TrackingInfo"],function(t,e){"use strict";var n={},r=["PENDING","STARTED","STOPPED"];return function i(o){function s(t){function e(t){return[].concat.apply([],t.children.filter(function(t){return t.state!==a.States.STOPPED}).concat(t.children.map(e)))}function n(t){return t.label+": "+r[t.state]}var i=e(t),o="The following child timers are in an invalid state:";if(i.length)throw o=i.reduce(function(t,e){return t+"\n\t- "+n(e)},o),new Error(o)}function a(t){this.label=t,this.type="timer",this.parent=null,this.children=[],this.state=a.States.PENDING}return a.States=r.reduce(function(t,e,n){return t[e]=n,t},{}),a.prototype.add=function(t){var e=i.create(this.label+"/"+t);return e.parent=this,this.children.push(e),e},a.prototype.remove=function(t){"string"==typeof t&&(t=this.label+"/"+t);var e=this.children.reduce(function(e,n,r){return n.label===t||n===t?{child:n,index:r}:e},{child:void 0,index:-1});return e.child&&(e.child.parent=null,this.children.splice(e.index,1)),e.child},a.prototype.start=function(){if(this.state===a.States.STARTED)throw new Error("Invalid Operation: Timer `"+this.label+"` already started.");this.reset(),this.startTime=t.now(),this.state=a.States.STARTED},a.prototype.stop=function(r){if(this.state!==a.States.STARTED)throw new Error("Invalid Operation: Timer `"+this.label+"` not started.");s(this),this.data=r,this.stopTime=t.now(),this.state=a.States.STOPPED,this.count=n[this.label]=(n[this.label]||0)+1,null===this.parent&&o(new e(this))},a.prototype.reset=function(){delete this.data,delete this.startTime,delete this.stopTime,this.state=a.States.PENDING},i.create=function(t){if("string"!=typeof t||!t.length)throw new Error("A timer name must be specified.");return new a(t)},i.reset=function(){n={}},i}}),n("mixins/Marks",["../Stopwatch","../TrackingInfo"],function(t,e){"use strict";var n=[],r=[],i=function(t){return function(e){return e.label===t}},o=function(t){return void 0!==t&&"string"==typeof t&&t.trim().length>0},s=function(t){return function(e,n){return e+(n.label===t?1:0)}},a=t.navigationStart,c=function(e,r,i){var o={data:r,label:e,type:"mark",start:a,stop:t.now(),count:n.reduce(s(e),1)};return!i&&window.performance&&window.performance.mark(e),n.push(o),o},u=function(e,c,u,f,l){var d,p,h,m,w,g=i(u),v=i(c),x=o(c),y=o(u);for(d=n.length-1;d>=0&&(w=n[d],!function(){return!m&&g(w)}()?function(){return!h&&v(w)}()&&function(){return!!m||!y}()&&(h=w):m=w,!function(){return!!h&&!!m}());d--);if(x||(h={stop:a}),y||(m={stop:t.now()}),h&&m)return p={data:f,label:e,type:"measure",start:h.stop,stop:m.stop,duration:m.stop-h.stop,count:r.reduce(s(e),1)},l&&(p.children=n.filter(function(t){return t.stop>=h.stop&&t.stop<=m.stop})),window.performance&&(c?u?window.performance.measure(e,c||void 0,u||void 0):window.performance.measure(e,c||void 0):window.performance.measure(e)),r.push(p),p},f=function(t,e,r){if("string"==typeof t)t=new RegExp(t,"i");else if(void 0===t)t=/./;else if(!(t instanceof RegExp))throw new Error("Regular expression or string expected.");var i=function(e){return t.test(e.label)},o=window.performance&&window.performance[r]?window.performance[r].bind(window.performance):Function.prototype;e.filter(i).forEach(function(t){e===n&&"navigationStart"===t.label||(o(t.label),e.splice(e.indexOf(t),1))})},l=function(){var t={};return Array.prototype.slice.call(arguments).reduce(function(t,e){return e&&"object"==typeof e&&Object.getOwnPropertyNames(e).reduce(function(t,n){return t[n]=e[n],t},t),t},t),t};return function t(i){return t.set=t.mark=function(t,n){if("string"!=typeof t||!t.length)throw new Error("A mark name must be specified.");i(new e(c(t,n)))},t.start=function(e,n){return t.set("Start: "+e,n),function(r){return t.stop(e,l(n,r))}},t.stop=function(e,n,r){t.set("Stop: "+e,n),t.measure(e,"Start: "+e,"Stop: "+e,n,r)},t.measure=function(t,n,r,o,s){if("string"!=typeof t||!t.length)throw new Error("Parameter `name` is required.");var a=u(t,n,r,o,s);a&&i(new e(a))},t.getMarks=function(){return n.concat()},t.getMeasures=function(){return r.concat()},t.clearMarks=function(t){f(t,n,"clearMarks")},t.clearMeasures=function(t){f(t,r,"clearMeasures")},t.reset=function(){r=[],n=[{data:{},count:1,type:"mark",stop:a,start:a,label:"navigationStart"}]},t.reset(),t}}),n("mixins/Network",["../TrackingInfo","../Stopwatch"],function(t,e){"use strict";return function n(r){n.getEntries=function(){return i.concat()};var i=[],o=0,s={},a=window.performance,c=e.navigationStart,u=function(t){return t.responseEnd<t.requestStart||t.responseEnd<t.startTime},f=function(e){return new t({type:"network",label:e.name,start:c+e.startTime,stop:c+e.responseEnd,category:e.initiatorType,count:s[e.name]=(s[e.name]||0)+1,data:{size:e.transferSize,encodedSize:e.encodedBodySize,decodedSize:e.decodedBodySize,cachedOrLocal:e.fetchStart===e.connectEnd,blockTime:Math.max(0,(e.requestStart||e.fetchStart)-e.startTime),stages:{fetch:{start:c+e.fetchStart,end:c+e.domainLookupStart,duration:e.domainLookupStart-e.fetchStart},dns:{start:c+e.domainLookupStart,end:c+e.domainLookupEnd,duration:e.domainLookupEnd-e.domainLookupStart},tcp:{start:c+e.connectStart,end:c+e.connectEnd,duration:e.connectEnd-e.connectStart},request:{start:c+e.requestStart,end:c+e.responseStart,duration:e.responseStart-e.requestStart},response:{start:c+e.responseStart,end:c+e.responseEnd,duration:e.responseEnd-e.responseStart}}}})},l=function(){var t=a.getEntriesByType("resource").slice(o);t.some(u)||(t=t.map(f),t.forEach(r),i=i.concat(t),o+=t.length)};if(a&&a.getEntriesByType){var d=function(){l(),a.clearResourceTimings&&a.clearResourceTimings(),a.webkitClearResourceTimings&&a.webkitClearResourceTimings(),o=0};a.onresourcetimingbufferfull=a.onwebkitresourcetimingbufferfull=d,setInterval(l,1e3)}return n}}),n("mixins/Static",["../TrackingInfo"],function(t){"use strict";return function(e,n){var r=["page","app","screen"],i={},o={},s={},a=Object.prototype.toString,c=function t(e){return e=e||{},Array.prototype.slice.call(arguments,1).reduce(function(e,n){return Object.keys(n).reduce(function(e,r){return"[object Object]"===a.call(n[r])?e[r]=t(e[r],n[r]):e[r]=n[r],e},e)},e)};n(function(t){t.data.context=c(t.data.context,s),t.data.metrics=c(t.data.metrics,i),t.data.dimensions=c(t.data.dimensions,o)}),this.setContext=function(n,r,i){this.unsetContext(n),s[n]=r,e(new t({type:"context",label:r,data:i||{},category:n}))},this.getContext=function(t){return s[t]||"not set"},this.unsetContext=function(n,o){var a=r.concat(n),u=a.indexOf(n);a.slice(u).forEach(function(t){s[t]="not set",-1===r.indexOf(n)&&delete s[t];var e=c(i[t]);for(var o in e)e.hasOwnProperty(o)&&this.setMetric(t,o)}.bind(this)),o&&-1!==u&&e(new t({label:"",type:"context",category:n}))},this.setMetric=function(n,o,s){i[n]=i[n]||{},i[n][o]=s,void 0!==s&&""!==s||(s="",delete i[n][o]),-1!==r.indexOf(n)||Object.keys(i[n]).length||delete i[n],e(new t({label:o,type:"metric",category:n,variable:s}))},this.getMetric=function(t,e){return i[t]&&i[t][e]},this.setDimension=function(n,r){o[n]=r,void 0!==r&&""!==r||delete o[n],e(new t({label:n,type:"dimension",variable:void 0===r||null===r?"":r.toString()}))},this.getDimension=function(t){return o[t]},this.reset=function(){i={},o={},s={},r.forEach(function(t){i[t]={},s[t]="not set"})}}}),n("mixins/Collectors",[],function(){"use strict";function t(t,e){var n=[],r=!0,i=[],o=[],s=function(t,e){return t=e(t)||t},a=function(t){i.forEach(function(e){e.collect(t)})};this.add=function(t){if(!t||"function"!=typeof t.collect)throw new Error("Collectors must have a `collect` method.");return i.push(t),this.remove.bind(null,t)},this.remove=function(t){i.splice(i.indexOf(t),1)},this.decorate=function(t){if("function"!=typeof t)throw new Error("Parameter `decorator` must be a function.");return o.push(t),function(){o.splice(o.indexOf(t),1)}},this.enable=function(){r=!1,n.forEach(a),n=[]},this.disable=function(){r=!0},this.collect=function(t){e&&e.collectors.collect(t),t=o.reduce(s,t),r?n[n.length]=t:a(t)},this.reset=function(){n=[],i=[],r=!0}}return t}),n("Tracking",["mixins/Errors","mixins/Events","mixins/Timers","mixins/Marks","mixins/Network","mixins/Static","mixins/Collectors","./uuid"],function(t,e,n,r,i,o,s,a){"use strict";function c(c){this.collectors=new s(this,c);var u=this.collectors.collect.bind(this.collectors),f=this.collectors.decorate.bind(this.collectors);this.errors=t(u),this.events=e(u),this.timers=n(u),this.marks=r(u),this.static=new o(u,f),this.network=i(u),this.generateUUID=a}return c.prototype.createChild=function(){return new c(this)},new c}),e("Tracking")});