/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Dan Barnes
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */

(function(e,t){typeof define=="function"&&define.amd?define([],t):e.Tracking=t()})(this,function(){var e,t,n;return function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.slice(0,v.length-1).concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){var n=p.call(arguments,0);return typeof n[0]!="string"&&n.length===1&&n.push(null),s.apply(r,n.concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../node_modules/almond/almond",function(){}),n("Stopwatch",[],function(){"use strict";function e(){}return e.now=Date.now||function(){return(new Date).getTime()},e}),n("uuid",[],function(){"use strict";function e(e){var t,n;if(window.crypto&&window.crypto.getRandomValues)t=new Uint8Array(e),window.crypto.getRandomValues(t);else{t=new Array(e),n=(new Date).getTime();while(e--)t[e]=n+Math.random()*16&15}return t}return function(){var n=e(36);return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e,t){var r=n[t]&15;return(e==="x"?r:r&3|8).toString(16)})}}),n("TrackingInfo",["./Stopwatch","./uuid"],function(e,t){"use strict";function n(){var e=[].slice.call(arguments),t=e.shift();while(e.length&&t===undefined)t=e.shift();return t}function r(e){var t=[].slice.call(arguments),r=t.pop(),i=t.slice(1);return i.reduce(function(t,r){return n((e.data||{})[r],e[r],t)},r)}function i(e){return Object.keys(e).reduce(function(n,r){return n[r]=e[r],n},{})}return function s(n){if(!(this instanceof s))return new s(n);this.data=i(n.data||{}),this.tags=r(n,"tags",[]),this.count=r(n,"count",1),this.type=r(n,"type","unknown"),this.id=r(n,"id",undefined)||t(),this.start=r(n,"start","startTime",e.now()),this.stop=r(n,"stop","stopTime","end","endTime",this.start),this.duration=this.stop-this.start,this.label=r(n,"label","description",undefined),this.action=r(n,"action",undefined),this.category=r(n,"category",undefined),this.variable=r(n,"variable",undefined),this.children=r(n,"children",[]).map(s),Object.keys(this).forEach(function(e){delete this.data[e]}.bind(this)),this.toString=function o(){return"TrackingInfo: "+JSON.stringify(this,null,2)},Object.freeze(this)}}),n("mixins/Errors",["../TrackingInfo"],function(e){"use strict";return function t(n){return t.log=function(r){if(!(r instanceof Error))throw new Error("An Error instance must be specified.");var i=new e({type:"error",data:r});i.data.stack=r.stack,n(i)},t}}),n("mixins/Events",["../TrackingInfo"],function(e){"use strict";return function t(n){return t.fire=function(r,i){if(typeof r!="string"||!r.length)throw new Error("An event action must be specified.");n(new e({action:r,data:i,type:"event"}))},t}}),n("mixins/Timers",["../Stopwatch","../TrackingInfo"],function(e,t){"use strict";var n={},r=["PENDING","STARTED","STOPPED"];return function i(s){function o(e){function t(e){return[].concat.apply([],e.children.filter(function(t){return t.state!==u.States.STOPPED}).concat(e.children.map(t)))}function n(e){return e.label+": "+r[e.state]}var i=t(e),s="The following child timers are in an invalid state:";if(!!i.length)throw s=i.reduce(function(t,r){return t+"\n	- "+n(r)},s),new Error(s)}function u(e){this.label=e,this.type="timer",this.parent=null,this.children=[],this.state=u.States.PENDING}return u.States=r.reduce(function(t,n,r){return t[n]=r,t},{}),u.prototype.add=function(t){var n=i.create(this.label+"/"+t);return n.parent=this,this.children.push(n),n},u.prototype.remove=function(t){typeof t=="string"&&(t=this.label+"/"+t);var n=this.children.reduce(function(e,n,r){return n.label===t||n===t?{child:n,index:r}:e},{child:undefined,index:-1});return!n.child||(n.child.parent=null,this.children.splice(n.index,1)),n.child},u.prototype.start=function(){if(this.state===u.States.STARTED)throw new Error("Invalid Operation: Timer `"+this.label+"` already started.");this.reset(),this.startTime=e.now(),this.state=u.States.STARTED},u.prototype.stop=function(i){if(this.state!==u.States.STARTED)throw new Error("Invalid Operation: Timer `"+this.label+"` not started.");o(this),this.data=i,this.stopTime=e.now(),this.state=u.States.STOPPED,this.count=n[this.label]=(n[this.label]||0)+1,this.parent===null&&s(new t(this))},u.prototype.reset=function(){delete this.data,delete this.startTime,delete this.stopTime,this.state=u.States.PENDING},i.create=function(t){if(typeof t!="string"||!t.length)throw new Error("A timer name must be specified.");return new u(t)},i.reset=function(){n={}},i}}),n("mixins/Marks",["../Stopwatch","../TrackingInfo"],function(e,t){"use strict";var n=[],r=[],i=function(t){return function(n,r){return r.label===t?r:n}},s=function(t){return function(n,r){return n+(r.label===t?1:0)}},o=function(){function t(e,t){return!e||!e[t]?null:e[t]}return["performance","timing","navigationStart"].reduce(t,window)||e.now()}(),u=function(r,i,u){var a={data:i,label:r,type:"mark",start:o,stop:e.now(),count:n.reduce(s(r),1)};return!u&&!!window.performance&&window.performance.mark(r),n.push(a),a},a=function(o,u,a,f,l){var c,h=n.reduce(i(u),null),p=n.reduce(i(a),null);if(typeof u!="string"||!u.length)h=n.reduce(i("navigationStart"),null);if(typeof a!="string"||!a.length)p={stop:e.now()};if(!!h&&!!p)return c={data:f,label:o,type:"measure",start:h.stop,stop:p.stop,duration:p.stop-h.stop,count:r.reduce(s(o),1)},!l||(c.children=n.filter(function(t){return t.stop>=h.stop&&t.stop<=p.stop})),!window.performance||(u?a?window.performance.measure(o,u||undefined,a||undefined):window.performance.measure(o,u||undefined):window.performance.measure(o)),r.push(c),c},f=function(t,r,i){if(typeof t=="string")t=new RegExp(t,"i");else if(t===undefined)t=/./;else if(!(t instanceof RegExp))throw new Error("Regular expression or string expected.");var s=function(n){return t.test(n.label)},o=!window.performance||!window.performance[i]?Function.prototype:window.performance[i].bind(window.performance);r.filter(s).forEach(function(t){if(r!==n||t.label!=="navigationStart")o(t.label),r.splice(r.indexOf(t),1)})};return function l(e){return l.set=l.mark=function(r,i){if(typeof r!="string"||!r.length)throw new Error("A mark name must be specified.");e(new t(u(r,i)))},l.start=function(t,n){l.set("Start: "+t,n)},l.stop=function(t,n,r){l.set("Stop: "+t,n),l.measure(t,"Start: "+t,"Stop: "+t,n,r)},l.measure=function(r,i,s,o,u){if(typeof r!="string"||!r.length)throw new Error("Parameter `name` is required.");var f=a(r,i,s,o,u);!f||e(new t(f))},l.getMarks=function(){return n.concat()},l.getMeasures=function(){return r.concat()},l.clearMarks=function(t){f(t,n,"clearMarks")},l.clearMeasures=function(t){f(t,r,"clearMeasures")},l.reset=function(){r=[],n=[{data:{},count:1,type:"mark",stop:o,start:o,label:"navigationStart"}]},l.navigationStart=o,l.reset(),l}}),n("mixins/Network",["../TrackingInfo","./Marks"],function(e,t){"use strict";return function n(r){n.getEntries=function(){return i.concat()};var i=[],s=0,o={},u=window.performance,a=function(t){return t.responseEnd<t.requestStart},f=function(r){return new e({type:"network",label:r.name,start:t.navigationStart+r.startTime,stop:t.navigationStart+r.responseEnd,category:r.initiatorType,count:o[r.name]=(o[r.name]||0)+1,data:{size:r.transferSize,cachedOrLocal:r.fetchStart===r.connectEnd,blockTime:Math.max(0,(r.requestStart||r.fetchStart)-r.startTime),stages:{fetch:{start:t.navigationStart+r.fetchStart,end:t.navigationStart+r.domainLookupStart,duration:r.domainLookupStart-r.fetchStart},dns:{start:t.navigationStart+r.domainLookupStart,end:t.navigationStart+r.domainLookupEnd,duration:r.domainLookupEnd-r.domainLookupStart},tcp:{start:t.navigationStart+r.connectStart,end:t.navigationStart+r.connectEnd,duration:r.connectEnd-r.connectStart},request:{start:t.navigationStart+r.requestStart,end:t.navigationStart+r.responseStart,duration:r.responseStart-r.requestStart},response:{start:t.navigationStart+r.responseStart,end:t.navigationStart+r.responseEnd,duration:r.responseEnd-r.responseStart}}}})},l=function(){var t=u.getEntriesByType("resource").slice(s);if(t.some(a))return;t=t.map(f),t.forEach(r),i=i.concat(t),s+=t.length};if(!!u&&!!u.getEntriesByType){var c=function(){l(),u.clearResourceTimings&&u.clearResourceTimings(),u.webkitClearResourceTimings&&u.webkitClearResourceTimings(),s=0};u.onresourcetimingbufferfull=u.onwebkitresourcetimingbufferfull=c,setInterval(l,1e3)}return n}}),n("mixins/Static",["../TrackingInfo"],function(e){"use strict";return function(n,r){var i=["page","app","screen"],s={},o={},u={},a=Object.prototype.toString,f="[object Object]",l=function c(e){return e=e||{},Array.prototype.slice.call(arguments,1).reduce(function(t,n){return Object.keys(n).reduce(function(t,r){return a.call(n[r])===f?t[r]=c(t[r],n[r]):t[r]=n[r],t},t)},e)};r(function(t){t.data.context=l(t.data.context,u),t.data.metrics=l(t.data.metrics,s),t.data.dimensions=l(t.data.dimensions,o)}),this.setContext=function(r,i,s){this.unsetContext(r),u[r]=i,n(new e({type:"context",label:i,data:s||{},category:r}))},this.getContext=function(t){return u[t]||"not set"},this.unsetContext=function(r,o){var a=i.concat(r),f=a.indexOf(r);a.slice(f).forEach(function(t){u[t]="not set",i.indexOf(r)===-1&&delete u[t];var n=l(s[t]);for(var o in n)n.hasOwnProperty(o)&&this.setMetric(t,o)}.bind(this)),!!o&&f!==-1&&n(new e({label:"",type:"context",category:r}))},this.setMetric=function(r,o,u){s[r]=s[r]||{},s[r][o]=u;if(typeof u=="undefined"||u==="")u="",delete s[r][o];i.indexOf(r)===-1&&!Object.keys(s[r]).length&&delete s[r],n(new e({label:o,type:"metric",category:r,variable:u}))},this.getMetric=function(t,n){return s[t]&&s[t][n]},this.setDimension=function(r,i){o[r]=i,(i===undefined||i==="")&&delete o[r],n(new e({label:r,type:"dimension",variable:i===undefined||i===null?"":i.toString()}))},this.getDimension=function(t){return o[t]},this.reset=function(){s={},o={},u={},i.forEach(function(t){s[t]={},u[t]="not set"})}}}),n("mixins/Collectors",[],function(){"use strict";function e(e,t){var n=[],r=!0,i=[],s=[],o=function(t,n){return t=n(t)||t},u=function(t){i.forEach(function(n){n.collect(t)})};this.add=function(t){if(!t||typeof t.collect!="function")throw new Error("Collectors must have a `collect` method.");return i.push(t),this.remove.bind(null,t)},this.remove=function(t){i.splice(i.indexOf(t),1)},this.decorate=function(t){if(typeof t!="function")throw new Error("Parameter `decorator` must be a function.");return s.push(t),function(){s.splice(s.indexOf(t),1)}},this.enable=function(){r=!1,n.forEach(u),n=[]},this.disable=function(){r=!0},this.collect=function(i){t&&t.collectors.collect(i),i=s.reduce(o,i),r?n[n.length]=i:u(i)},this.reset=function(){n=[],i=[],r=!0}}return e}),n("Tracking",["mixins/Errors","mixins/Events","mixins/Timers","mixins/Marks","mixins/Network","mixins/Static","mixins/Collectors","./uuid"],function(e,t,n,r,i,s,o,u){"use strict";function a(a){this.collectors=new o(this,a);var f=this.collectors.collect.bind(this.collectors),l=this.collectors.decorate.bind(this.collectors);this.errors=e(f),this.events=t(f),this.timers=n(f),this.marks=r(f),this.static=new s(f,l),this.network=i(f),this.generateUUID=u}return a.prototype.createChild=function(){return new a(this)},new a}),t("Tracking")});